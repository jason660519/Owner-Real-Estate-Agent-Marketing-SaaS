# 軟體架構與硬體架構選型說明書

## 1. 專案背景與目標 (Project Background)
本專案旨在開發一款「房東物件管理語音 AI App」，透過自然語言對話（語音/文字）協助房東處理從招租、篩選租客、簽約、維修到財務報表的一站式管理。核心競爭力在於高度自動化的 AI 助理與文件、網站生成能力。

---

## 2. 軟體架構選型 (Software Architecture)

### 2.1 核心開發框架 (Core Frameworks)

#### 前端開發 (Frontend)
*   **框架**: **Expo** (基於 React Native)
    *   **優勢**: 支援一套代碼同時部署至 iOS、Android 與 Web 三大平台，擁有豐富的生態系與開發工具鏈。

#### 後端服務 (Backend as a Service)
*   **核心後端**: **Supabase** 
    *   **PostgreSQL 資料庫**:
        *   儲存 JSONB 格式的文檔資料（如 PDF 解析結果）。
        *   管理關聯式資料（物件、租約、財務紀錄）。
    *   **Authentication (身份驗證)**: 處理房東/租客登入，支援 JWT 與 Row Level Security (RLS) 確保多租戶資料隔離。
    *   **Storage (物件儲存)**: 存放房屋照片、合約 PDF、證明文件。
    *   **Realtime (即時通訊)**: 支援狀態即時更新與訊息推播。
    *   **Edge Functions**: 處理後端邏輯與第三方 API 串接。

### 2.2 AI 核心與代理人系統 (AI Core & Agents)

#### AI 基礎設施
*   **對話管理框架**: **Rasa** (容器化部署)
    *   負責意圖識別 (Intent Recognition) 與對話流程控制。
*   **大語言模型 (LLM)**:
    *   **主力**: **OpenAI GPT-4o** (負責複雜邏輯、文案生成、合約起草)。
    *   **備援**: **Anthropic Claude 3.5 Sonnet**。
*   **房東可用語音或打文字方式與AI溝通**:
    *   使用手機原生 STT (iOS/Android) 以降低STT延遲與成本。

#### AI Agent 角色分工
系統根據用戶意圖將任務分發給專屬 Agent：
1.  **Website Creator Agent**: 自動生成物件行銷網頁。
2.  **Legal Agent**: 各國租賃法規解說員，
3.  **Lease Agreement Creator**: 負責起草與審核合約。
3.  **Accountant Agent**: 負責財務計算、生成稅務報表。
4.  **Concierge Agent**: 管理維修請求、聯繫廠商與安排行事曆。
5.  **Document Parser**: 透過視覺模型 (Vision LLM/OCR) 自動解析權狀、謄本以提取關鍵字並生成json檔供後續資料庫使用。

### 2.3 第三方服務整合 (Integrations) - 區域化策略

針對 **澳洲 (AU)** 與 **台灣 (TW)** 市場的特殊性，建議採用以下本地化服務以符合法規與用戶習慣：

#### 1. 金流支付 (Payments)
*   **澳洲市場 (Australia)**
    *   **主力推薦**: **Zai (前身為 Assembly Payments)**
        *   **理由**: 專為 PropTech 設計，原生支援 **BPAY** (澳洲租金支付標準) 與 Real-Time Payments (NPP)。其 Split Payments 流程非常適合「租客 -> 平台 -> 房東」的分潤模式。
    *   **備選**: **Stripe Connect** (全球通用，但對 BPAY 支援較弱，手續費略高)。
*   **台灣市場 (Taiwan)**
    *   **主力推薦**: **NewebPay (藍新金流)**
        *   **理由**: 提供完整的「代收代付」平台方案，適合處理租金分帳與撥款邏輯，且支援台灣主流的 ATM 轉帳與超商代碼繳費。
    *   **備選**: **ECPay (綠界科技)** (市佔率最高，穩定性強，但分帳 API 門檻較高)。

#### 2. 通訊服務 (Communications)
*   **澳洲市場 (Australia)**
    *   **主力推薦**: **MessageMedia**
        *   **理由**: 澳洲本地龍頭，傳送到達率高，價格優於國際漫遊簡訊。
    *   **備選**: **Twilio** (全球通用)。
*   **台灣市場 (Taiwan)**
    *   **主力推薦**: **Mitake (三竹資訊)**
        *   **理由**: 台灣金融業標準，針對台灣手機號碼的到達率最高，不易被擋信。
    *   **備選**: **Every8d (互動資通)** (API 文件友善，適合開發者)。

#### 3. 電子簽章 (E-Signature)
*   **澳洲市場 (Australia)**
    *   **法律依據**: 符合 *Electronic Transactions Act 1999*。
    *   **建議**: **DocuSeal** (自架/低成本) 或 **DocuSign** (高信任度商用合約)。
*   **台灣市場 (Taiwan)**
    *   **法律依據**: 符合 *電子簽章法 (Electronic Signatures Act)*。
    *   **建議**: **DottedSign (點點簽)** (凱甸行動科技)。
        *   **理由**: 台灣本土服務，符合在地法規，支援中華電信 A+ 信賴時戳，在法律舉證上更具優勢。

### 2.4 專案管理
*   **工具**: **Vibe Kanban**

---

## 3. 硬體架構選型 (Hardware Architecture)

為了確保 AI 運算的隱私性與開發靈活性，本專案規劃了自建伺服器（Self-hosted Server）作為地端或私有雲部署選項。

### 3.1 伺服器規格配置 (Server Specifications)

| 硬體組件 | 建議規格 | 選型理由 |
| :--- | :--- | :--- |
| **主機類型** | **MSI Desktop PC** (高階工作站) | 具備良好的擴充性與散熱，適合長時間運行。 |
| **處理器 (CPU)** | **16 核心** (AMD Ryzen 9 或 Intel i9) | 提供足夠的平行運算能力，支援多容器 (Docker) 同時運行。 |
| **記憶體 (RAM)** | **64GB** (DDR4/DDR5) | 運行 Supabase 資料庫、Rasa 模型與多個微服務所需的記憶體空間。 |
| **顯示卡 (GPU)** | **NVIDIA RTX 3090 24G** | **關鍵組件**。24GB VRAM 足以支撐本地 LLM 推論、OCR 運算與 Rasa NLU 模型訓練。 |
| **系統碟** | **1TB SSD** (NVMe M.2) | 安裝 OS (Linux/Windows WSL) 與應用程式，確保快速啟動與 I/O。 |
| **資料碟** | **4TB SSD** | 儲存大量的物件照片、備份資料庫與訓練數據集。 |

### 3.2 伺服器用途與部署規劃
1.  **AI 模型訓練與推論**:
    *   作為 Rasa NLU 的訓練伺服器。
    *   運行本地端開源 LLM (如 Llama 3) 或 OCR 模型以降低 token 成本。
2.  **私有化後端託管**:
    *   透過 Docker Compose 部署 Self-hosted Supabase。
    *   運行開源微服務：DocuSeal (簽約), Postal (郵件), Fonoster (簡訊)。
3.  **開發與測試環境**:
    *   作為 CI/CD Pipeline 的 Build Server。
